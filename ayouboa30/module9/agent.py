import random

class Agent:
    def __init__(self, env):
        self.env = env
        
        self.Q = [[0.5485919009259289, 0.5122101637498695, 0.5221051758667569, 0.5204045828360458], [0.36476355726302245, 0.3071347412805255, 0.36460982265233144, 0.5021483034329793], [0.45320808902097204, 0.45010125057804906, 0.41731697363166476, 0.46737429442015804], [0.2318725963114771, 0.2653330775027542, 0.31612380178079, 0.4539323305296447], [0.5783946700148189, 0.3002997162713605, 0.2637927157697642, 0.3061571593690659], [0.0, 0.0, 0.0, 0.0], [0.39181479321673307, 0.18715014454830756, 0.2675988266055113, 0.14718404255200243], [0.0, 0.0, 0.0, 0.0], [0.44219251946899096, 0.5243969200047434, 0.5033652883263943, 0.6123612003904908], [0.4355456259745628, 0.6430114490436017, 0.4706327280569082, 0.38843537982224563], [0.645483810206497, 0.43292264938484243, 0.41864080155497435, 0.3775905608058364], [0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0], [0.36416459641732335, 0.693842142050282, 0.7274925601524941, 0.43946416826565704], [0.7340924284248898, 0.8844885983943047, 0.8210897904133792, 0.7633499872032633], [0.0, 0.0, 0.0, 0.0]]
        self.nS = len(self.Q)
        self.nA = len(self.Q[0]) if self.nS>0 else env.action_space.n

    def choose_action(self, observation, reward=0.0, terminated=False, truncated=False, info=None):
        s = int(observation)

        if s < 0 or s >= self.nS:
            return self.env.action_space.sample()

        row = self.Q[s]
        m = max(row)
        
        TOLERANCE = 1e-6 
        meilleures = [a for a, q in enumerate(row) if abs(q - m) < TOLERANCE]

        if meilleures:
            return random.choice(meilleures)
        else:
            return self.env.action_space.sample()